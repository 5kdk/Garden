# **39장 DOM**

- [**39장 DOM**](#39장-dom)
  - [**들어가며 🎈**](#들어가며-)
  - [**노드**](#노드)
    - [**HTML 요소와 노드 객체**](#html-요소와-노드-객체)
    - [**노드 객체의 타입**](#노드-객체의-타입)
    - [**노드 객체의 상속 구조**](#노드-객체의-상속-구조)
  - [**요소 노드 취득**](#요소-노드-취득)
    - [**id를 이용한 요소 노드 취득**](#id를-이용한-요소-노드-취득)
    - [**태그 이름을 이용한 요소 노드 취득**](#태그-이름을-이용한-요소-노드-취득)
    - [**class를 이용한 요소 노드 취득**](#class를-이용한-요소-노드-취득)
    - [**css 선택자를 이용한 요소 노드 취득**](#css-선택자를-이용한-요소-노드-취득)
    - [**특정 요소 노드를 취득할 수 있는지 확인**](#특정-요소-노드를-취득할-수-있는지-확인)
    - [**HTMLCollection과 NodeList**](#htmlcollection과-nodelist)
  - [**노드 탐색**](#노드-탐색)
    - [**공백 텍스트 노드**](#공백-텍스트-노드)
    - [**자식 노드 탐색**](#자식-노드-탐색)
    - [**자식 노드 존재 확인**](#자식-노드-존재-확인)
    - [**요소 노드의 텍스트 노드 탐색**](#요소-노드의-텍스트-노드-탐색)
    - [**부모 노드 탐색**](#부모-노드-탐색)
    - [**형제 노드 탐색**](#형제-노드-탐색)
  - [**노드 정보 취득**](#노드-정보-취득)
  - [**요소 노드의 텍스트 조작**](#요소-노드의-텍스트-조작)


<br>

## **들어가며 🎈**

본 정리글은 이웅모강사님의 모던 자바스크립트 Deep Dive를 공부하고 습득하기 위해 제 나름대로 정리한 글 입니다. 보다 상세한 정보를 원하신다면 해당 서적을 참고하시길 바랍니다.

브라우저 렌더링 엔진은 HTML 문서를 파싱하여 브라우저가 이해할 수 있는 자료구조인 DOM을 생성한다. DOM은 HTML 문서의 계층적 구조와 정보를 표현하며 이를 제어할 수 있는 API, 즉 프로퍼티와 메서드를 제공하는 트리 자료구조다.

<br>

## **노드**

### **HTML 요소와 노드 객체**

```html
<div class="greeting">Hello</div>
// div: 시작태그 // class: 어트리뷰트 이름 // "greeting": 어트리뷰트 값 //
Hello: 콘텐츠 // /div: 종료 태그
```

- HTML 요소는 렌더링 엔진에 의해 파싱되어 DOM을 구성하는 요소 노드 객체로 변환된다. 이때 HTML 요소의 어트리뷰트는 어트리뷰트 노드로, HTML 요소의 텍스트 콘텐츠는 텍스트 노드로 변환된다.
- HTML 문서는 HTML 요소들의 집합으로 이뤄지며, 이때 HTML 요소 간에 중첩 관계에 의해 계층적인 부자관계가 형성된다.
- 요소간 부자관계를 반영하여 HTML 요소를 객체화한 모든 노드 객체들을 트리 자료구조로 구성한다.

**트리 자료구조**

- 트리 자료구조는 부모 노드(_parent node_)와 자식 노드(_child node_)로 구성되어 노드 간의 계층적 구조(부자, 형제 관계)를 표현하는 비선형 자료구조를 말한다.
- 트리 자료구조는 하나의 최상위 노드에서 시작한다. 최상위 노드는 부모 노드가 없으며 루트 노트(_root node_)라 한다. 루트 노드는 0개 이상의 자식 노드를 갖는다. 자식 노드가 없는 노드를 리프 노드(_leaf node_)라 한다.

**=> 노드 객체들로 구성된 트리 자료구조를 DOM이라 한다.(노드 객체의 트리로 구조화되어 있기 때문에 DOM을 DOM 트리라고 부르기도 한다.**

<br>

### **노드 객체의 타입**

> 📄 **공백 텍스트 노드**
>
> HTML 요소 사이의 개행이나 공백은 텍스트 노드가 된다

<br>

**문서 노드**(_document node_)

- 루트 노드로서 `document` 객체를 가리킨다
- 전역 객체 `window`의 `document` 프로퍼티에 바인딩되어 있다
  - `window.document` 또는 `document`로 참조할 수 있다
- 브라우저 환경의 모든 자바스크립트 코드는 `script` 태그에 의해 분리되어 있어도 하나의 전역 객체 `window`를 공유하기 때문에 문서당 `document` 객체는 동일하다
- DOM 트리의 노드들에 접근하기 위한 진입점 역할을 담당한다

**요소 노드**(_element node_)

- HTML 요소를 가리키는 객체
- 요소 간의 중첩에 의해 부자 관계를 가지며, 이를 통해 정보를 구조화한다
- 요소 노드는 문저의 구조를 표현한다라고 할 수 있다

**어트리뷰트 노드**(_attribute node_)

- HTML 요소의 어트리뷰트를 가리키는 객체다
- 어트리뷰트가 지정된 요소 노드와 연결되어 있다(부모 노드가 없다, 요소 노드의 형제 노드가 아니다)
- 어트리뷰트 노드에 접근하여 어트리뷰트를 참조하거나 변경하려면 먼저 요소 노드에 접근해야한다

**텍스트 노드**(_text node_)

- HTML 요소의 텍스트를 가리키는 객체다
- 요소 노드가 문서의 구조를 표현한다면 텍스트 노드는 문서의 정보를 표현한다고 할 수 있다
- 텍스트 노드는 요소 노드의 자식 노드이며, 자식 노드를 가질 수 없는 리프 노드다
- 즉, 텍스트 노드는 DOM 트리의 최종단이다
- 텍스트 노드에 접근하려면 먼저 부모 노드인 요소 노드에 접근해야한다

위 4가지 노드 타입 외에도 주석을 위한 `comment` 노드, `DOCTYPE`을 위한 `DocumentType` 노드, 복수의 노드를 생성하여 추가할 때 사용하는 `DocumentFragment` 노드 등 총 12개의 노드 타입이 있다.

<br>

### **노드 객체의 상속 구조**

- DOM을 구성하는 노드 객체는 자신의 구조와 정보를 제어할 수 있는 DOM API를 사용할 수 있다.  
  이를 통해 노드 객체는 자신의 부모, 형제, 자식을 탐색할 수 있으며, 자신의 어트리뷰트와 텍스트를 조작할 수도 있다
- DOM을 구성하는 노드 객체는 ECMAScript 사양에 정의된 표준 빌트인 객체가 아니라 브라우저 환경에서 추가적으로 제공하는 호스트 객체다.  
  하지만, 노드 객체도 자바스크립트 객체이므로 프로토타입에 의한 상속 구조를 갖는다
- 모든 노드 객체는 `Object`, `EventTarget`, `Node` 인터페이스를 상속받는다
  - 문서 노드는 `Document`, `HTMLDocument` 인터페이스를 상속받고 어트리뷰트노드는 `Attr`, 텍스트 노드는 `CharacterData` 인터페이스를 각각 상속받는다. 요소 노드는 `Element` 인터페이스를 상속받는다.
  - 요소 노드는 추가적으로 `HTMLElement`와 태그의 종류별로 세분화된 인터페이스(ex: `HTMLHtmlElement`, `HTMLHeadElement`, `HTMLBodyElement`, ... )를 상속받는다
- 프로토타입 체인 관점에서 예를 들어 `input` 요소 노드 객체는 프로토타입 체인에 있는 모든 프로토타입의 프로퍼티나 메서드를 상속받아 사용할 수 있다
- 노드 객체는 공통된 기능일수록 프로토타입 체인의 상위에, 개별적인 고유 기능일수록 프로토타입 체인 하위에 프로토타입 체인을 구축하여 노드 객체에 필요한 기능, 즉 프로퍼티와 메서드를 제공하는 상속의 구조를 갖는다
- 노드 객체의 상속 구조는 개발자 도구의 `Elements` 패널 우측의 `Properties` 패널에서 확인하자

**=> DOM은 HTML 문서의 계층적 구조와 정보를 표현하는 것은 물론 노드 객체의 종류, 즉 노드 타입에 따라 필요한 기능을 프로퍼티와 메서드의 집합인 DOM API로 제공한다.**  
**이 DOM API를 통해 HTML의 구조나 내용 또는 스타일 등을 동적으로 조작할 수 있다.**

<br>

---

## **요소 노드 취득**

요소 노드의 취득은 HTML 요소를 조작하는 시작점이다. 이를 위해 DOM은 요소 노드를 취득할 수 있는 다양한 메서드를 제공한다.

<br>

### **id를 이용한 요소 노드 취득**

`getElementById`

- 첫번째, 하나의 요소 노드 반환한다.
- 요소가 존재하지 않은 경우 `null` 반환한다.
- HTML 요소에 `id` 어트리뷰트를 부여하면 `id` 값과 동일한 이름의 전역 변수가 암묵적으로 선언되고 해당 노드 객체가 할당되는 부수 효과가 있다.
- 단, 이미 선언되어 있으면 이 전역 변수에 노드 객체가 재할당되지 않는다.

<br>

### **태그 이름을 이용한 요소 노드 취득**

`getElementByTagName`

- 인수로 전달한 태그 이름을 갖는 모든 요소 노드들을 탐색, 반환한다.
  - 여러 개의 요소 노드 객체를 갖는 DOM 컬렉션 객체인 `HTMLCollection` 객체를 반환한다.
- 반환하는 객체는 유사 배열 객체이면서 이터러블이다.
- 모든 요소를 취득하려면 인수로 `*`를 전달한다.
- `getElementByTagName` 메서드는 `Document.prototype`와 `Element.prototype`에 정의된 메서드 두가지가 있다.
- 전자는 DOM 전체, 후자는 특정 요소의 자손 노드 중에서 노드를 탐색하여 반환한다.
- 요소가 존재하지 않을 경우 빈 `HTMLCollection` 객체를 반환한다.

<br>

### **class를 이용한 요소 노드 취득**

`getElementByClassName`

- 인수로 전달한 `class`어트리뷰트 값을 갖는 모든 요소 노드들을 탐색, 반환한다.
  - 위와 마찬가지로 여러 개의 요소 노드 객체를 갖는 DOM 컬렉션 객체인 `HTMLCollection` 객체를 반환한다.(유사 배열 객체, 이터러블)
- 공백으로 구분하여 여러개의 `class`를 지정할 수 있다.
- `getElementByClassName` 메서드는 `Document.prototype`와 `Element.prototype`에 정의된 메서드 두가지가 있다.
- `Document.prototype.getElementByClassName`은 DOM 전체, `Element.prototype.getElementByClassName`는 특정 요소의 자손 노드 중에서 노드를 탐색하여 반환한다.
- 요소가 존재하지 않을 경우 빈 `HTMLCollection` 객체를 반환한다.

<br>

### **css 선택자를 이용한 요소 노드 취득**

`querySelector`

- 인수로 전달한 CSS 선택자를 만족시키는 요소 노드가 여러 개인 경우 첫 번째 요소 노드만 반환
- 만족시키는 요소 노드가 존재하지 않는 경우 `null` 반환한다.
- 문법에 맞지 않는 경우 `DOMException` 반환한다.
- `Document.prototype.querySelector`은 DOM 전체, `Element.prototype.querySelector`는 특정 요소의 자손 노드 중에서 노드를 탐색하여 반환한다.

`querySelectorAll`

- 인수로 전달한 CSS 선택자를 만족시키는 값을 갖는 모든 요소 노드들을 탐색, 반환한다.
  - 위와 마찬가지로 여러 개의 요소 노드 객체를 갖는 DOM 컬렉션 객체인 `NodeList` 객체를 반환한다.(유사 배열 객체, 이터러블)
- 만족시키는 요소 노드가 존재하지 않는 경우 빈 `NodeList` 반환한다.
- 문법에 맞지 않는 경우 `DOMException` 반환한다.
- `Document.prototype.querySelector`은 DOM 전체, `Element.prototype.querySelector`는 특정 요소의 자손 노드 중에서 노드를 탐색하여 반환한다.
- `getElementBy***` 메서드 보다 다소 느린 것으로 알려져 있지만, CSS 선택자 문법을 사용하여 좀 더 구체적인 조건으로 요소 노드를 취득할 수 있고 일관성을 가질 수 있다는 장점이 있다.(`id`어트리뷰트가 있는 요소 노드를 취득할 때를 제외하곤 `querySelector`, `querySelectorAll` 메서드를 사용하자)

<br>

### **특정 요소 노드를 취득할 수 있는지 확인**

`Element.prototype.matches`

- 인수로 전달한 CSS 선택자를 통해 특정 요소 노드를 취득할 수 있는지 확인한다.
- 이벤트 위임을 사용할 때 유용하다.

<br>

### **HTMLCollection과 NodeList**

- 유사 배열 객체이면서 이터러블
- `for ... of` 순회할 수 있고 스프레드 문법을 사용하여 간단히 배열로 변환 가능하다.
- 객체의 상태 변화를 실시간으로 반영하는 살아 있는 객체이다.
- `HTMLCollection` 은 언제나 live 객체로 동작한다.
- `NodeList`는 대부분 실시간으로 반영하지는 않고 경우에 따라 live 객체로 동작할 때가 있다.

**HTMLCollection**

- `getElementsByTagName`, `getElementsByClassName` 메서드가 반환하는 해당 객체는 노드 객체의 상태 변화를 실시간으로 반영하는 살아 있는 DOM 컬렉션 객체이다.
- 노드 객체 상태를 변경해야 할 때 주의해야 한다.
- 부작용을 해결하려면 배열로 변환하여 사용, 배열의 유용한 고차함수까지 사용할 수 있다.

**NodeList**

- 부작용을 해결하기 위해 `querySelectorAll`을 사용하는 방법도 있다.
- DOM 컬렉션 객체인 `NodeList` 는 non-live 객체다.
- 대부분은 정적 상태를 유지하는 non-live 객체로 동작하지만, `childNodes` 프로퍼티가 반환하는 `NodeList` 객체는 `HTMLCollection`와 같이 실시간으로 노드 객체의 상태를 변경을 반영하는 live 객체로 동작하므로 주의가 필요하다.

<br>

이 두 객체는 예상과 다르게 동작할 때가 있어 다루기 까다롭고 실수하기 쉽다. 노드 객체의 상태 변경과 상관없이 안전하게 DOM 컬렉션을 사용하려면 배열로 변환하여 사용할 것을 권장한다.

스프레드 문법이나 `Array.from` 메서드를 사용하여 간단히 배열로 변환하자.

<br>

---

## **노드 탐색**

- 노드 탐색 프로퍼티는 모두 접근자 프로퍼티다. 단, 노드 탐색 프로퍼티는 `setter`없이 `getter`만 존재하여 참조만 가능한 읽기 전용 접근자 프로퍼티다. 값을 할당하면 에러없이 무시한다.

<br>

### **공백 텍스트 노드**

- 스페이스, 탭, 개행 등의 공백 문자는 텍스트 노드를 생성한다.
- 노드를 탐색할 때는 공백 문자가 생성한 공백 텍스트 노드에 주의해야 한다.

<br>

### **자식 노드 탐색**

다음과 같은 노드 탐색 프로퍼티를 사용한다.

<center>프로퍼티</center> | <center>설명</center>
--- | ---
`Node.prototype.childNodes` | 자식 노드를 모두 탐색하여 DOM 컬렉션 객체인 `NodeList`에 담아 반환한다. `childNodes` 프로퍼티가 반환한 `NodeList`에는 요소노드뿐만 아니라 텍스트 노드도 포함되어 있을 수 있다.
`Element.prototype.children` | 자식 노드 중에서 요소 노드만 모두 탐색하여 DOM 컬렉션 객체인 `HTMLCollection`에 담아 반환한다. `children` 프로퍼티가 반환한 `HTMLCollection`에는 텍스트 노드가 포함되지 않는다.
`Node.prototype.firstChild` | 첫 번째 자식 노드를 반환한다. `Node.prototype.firstChild` 프로퍼티가 반환한 노드는 텍스트 노드이거나 요소 노드다. 
`Node.prototype.lastChild` | 마지막 자식 노드를 반환한다. `Node.prototype.lastChild` 프로퍼티가 반환한 노드는 텍스트 노드이거나 요소 노드다. 
`Element.prototype.firstElementChild` | 첫 번째 자식 노드를 반환한다. `Element.prototype.firstElementChild` 프로퍼티는 요소 노드만 반환한다. 
`Element.prototype.lastElementChild` | 마지막 자식 노드를 반환한다. `Element.prototype.lastElementChild` 프로퍼티는 요소 노드만 반환한다.

<br>

### **자식 노드 존재 확인**

- `Node.prototype.hasChildNodes` 메서드를 사용하여 자식 노드가 있는지 확인한다.
- `true`, `false`를 반환한다 `childNodes` 프로퍼티와 마찬가지로 텍스트 노드를 포함하여 자식 노드의 존재를 확인한다.
- 텍스트 노드가 아닌 요소 노드가 존재하는지 확인하려면 해당 메서드 대신 `children.length` 또는 `Element` 인터페이스의 `childElementCount` 프로퍼티를 사용한다.

<br>

### **요소 노드의 텍스트 노드 탐색**

- 요소 노드의 텍스트 노드는 요소 노드의 자식 노드다. `firstChild` 프로퍼티로 접근할 수 있다.

<br>

### **부모 노드 탐색**

- `Node.prototype.parentNode` 프로퍼티를 사용한다.
- 텍스트 노드는 DOM 트리의 최종단 노드인 리프 노드이르모 부모 노드가 텍스트 노드인 경우는 없다.

<br>

### **형제 노드 탐색**

부모 노드가 같은 형제 노드를 탐색하려면 다음과 같은 노드 탐색 프로퍼티를 사용한다.  
(어트리뷰트 노드는 요소 노드와 연결되어 있지만 형제 노드가 아니기 때문에 반환되지 않는다.)

텍스트 노드 또는 요소 노드만 반환한다.

<center>프로퍼티</center> | <center>설명</center>
--- | ---
`Node.prototype.previousSibling` | 부모 노드가 같은 형제 노드 중에서 자신의 이전 형제 노드를 탐색하여 반환한다. 반환하는 형제 노드는 요소 노드뿐만 아니라 텍스트 노드일 수도 있다.
`Node.prototype.nextSibling` | 부모 노드가 같은 형제 노드 중에서 자신의 다음 형제 노드를 탐색하여 반환한다. 반환하는 형제 노드는 요소 노드뿐만 아니라 텍스트 노드일 수도 있다.
`Element.prototype.previousElementSibling` | 부모 노드가 같은 형제 노드 중에서 자신의 이전 형제 노드를 탐색하여 반환한다. 요소 노드만 반환한다.
`Element.prototype.nextElementSibling` | 부모 노드가 같은 형제 노드 중에서 자신의 다음 형제 노드를 탐색하여 반환한다. 요소 노드만 반환한다.

<br>

---

## **노드 정보 취득**

노드 객체에 대한 정보를 취득하려면 다음과 같은 노드 정보 프로퍼티를 사용한다.

| 프로퍼티                  | 설명                                                                                                                                                                                                                                                                                                            |
| ------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Node.prototype.nodeType` | 노드 객체의 종류, 즉 노드 타입을 나타내는 상수를 반환한다. 노드 타입 상수는 `Node`에 정의되어 있다. <br> - `Node.ELEMENT_NODE`: 요소 노드 타입을 나타내는 상수 1을 반환 <br> - `Node.TEXT_NODE`: 텍스트 노드 타입을 나타내는 상수 3을 반환 <br> - `Node.DOCUMENT_NODE`: 문서 노드 타입을 나타내는 상수 9를 반환 |
| `Node.prototype.nodeName` | 노드의 이름을 문자열로 반환한다. <br> - 요소 노드: 대문자 문자열로 태그 이름을 반환 <br> - 텍스트 노드: 문자열 "#text"를 반환 <br> - 문서 노드: 문자열 "#document"를 반환                                                                                                                                       |

<br>

---

## **요소 노드의 텍스트 조작**
